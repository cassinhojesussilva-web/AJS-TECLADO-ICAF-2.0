<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teclado Virtual Responsivo</title>
<style>
body {
  display:flex; justify-content:center; align-items:center; height:100vh;
  background: linear-gradient(to bottom, #1c1c1c, #444);
  font-family: Arial, sans-serif;
  margin:0; overflow:hidden;
}
.piano-container {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
  background: #222;
  border-radius: 15px;
  box-shadow: 0 0 40px rgba(0,0,0,0.7);
  height: 95vh;
  width: 100vw;
  box-sizing: border-box;
}
.octave-display {
  text-align:center; color:#fff; font-size:16px; margin-bottom:10px;
  text-shadow: 0 0 5px #000;
}
.piano-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
  width: 100%;
  flex: 1;
}
.piano {
  position:relative; display:flex; user-select:none; height:100%;
  transform-origin: center center;
  transition: transform 0.1s;
}
.key {
  position: relative;
  border-radius:0 0 8px 8px;
  display:flex; align-items:flex-end; justify-content:center;
  font-size:10px; cursor:pointer;
  transition: transform 0.07s, background 0.1s, box-shadow 0.1s;
  box-shadow: 0 5px #555;
}
.key.white {
  width: min(50px, 8vw);
  height: 100%;
  background:#fff;
  margin-right:-1px;
  z-index:1;
}
.key.white.pressed {
  background:#ddd; transform:translateY(4px); box-shadow: 0 2px #333;
}
.key.black {
  width: min(32px, 5vw);
  height: 65%;
  background:#000; color:#fff;
  position:absolute;
  margin-left: calc(-1 * min(16px, 2.5vw));
  z-index:2;
}
.key.black.pressed {
  background:#333; transform:translateY(4px); box-shadow: 0 2px #111;
}
.note-label {
  position:absolute; bottom:5px; font-size:9px; color:#000;
}
.key.black .note-label { color:#fff; }
</style>
</head>
<body>
<div class="piano-container">
  <div class="octave-display" id="octaveDisplay">Oitava: 1</div>
  <div class="piano-wrapper">
    <div class="piano" id="piano"></div>
  </div>
</div>
<script>
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

// Criar notas A0-C8
const notes = [];
const noteNames = ['A','A#','B','C','C#','D','D#','E','F','F#','G','G#'];
let octave = 0;
for(let i=0;i<88;i++){
  const name = noteNames[i%12]+octave;
  const freq = 27.5 * Math.pow(2,i/12);
  notes.push({note:name,freq});
  if(noteNames[i%12]=='G') octave++;
}

const piano = document.getElementById("piano");

// Criar teclas
notes.forEach((noteObj)=>{
  const key = document.createElement("div");
  key.classList.add("key");
  if(noteObj.note.includes("#")) key.classList.add("black");
  else key.classList.add("white");
  const label = document.createElement("div");
  label.classList.add("note-label");
  label.textContent = noteObj.note;
  key.appendChild(label);

  // Suporte PC e celular
  key.addEventListener("mousedown", ()=>pressKey(key,noteObj.freq));
  key.addEventListener("touchstart", (e)=>{ e.preventDefault(); pressKey(key,noteObj.freq); });

  piano.appendChild(key);
});

// Posicionar teclas pretas
function positionBlackKeys(){
  const blackKeys = Array.from(document.querySelectorAll('.key.black'));
  let wIndex = 0;
  notes.forEach(noteObj=>{
    if(!noteObj.note.includes("#")) wIndex++;
    else {
      const key = blackKeys.shift();
      if(key) key.style.left = `${wIndex*50 - 16}px`;
    }
  });
}
positionBlackKeys();

// Som com envelope Attack/Decay
function playSound(freq){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type='sine';
  osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  const now = audioCtx.currentTime;
  gain.gain.setValueAtTime(0,now);
  gain.gain.linearRampToValueAtTime(0.25,now+0.02);
  gain.gain.linearRampToValueAtTime(0,now+0.5);
  osc.start();
  osc.stop(now+0.5);
}

// Efeito visual
function pressKey(keyElem,freq){
  keyElem.classList.add('pressed');
  playSound(freq);
  setTimeout(()=>keyElem.classList.remove('pressed'),120);
}

// Teclado fÃ­sico
const physicalKeys=['z','s','x','d','c','v','g','b','h','n','j','m',',','.','/','q','2','w','3','e','r','5','t','6','y','7','u','i','9','o','0','p','[',']'];
let octaveShift=1;
const octaveDisplay = document.getElementById('octaveDisplay');

window.addEventListener('keydown',(e)=>{
  if(e.key==="ArrowUp"){ octaveShift++; octaveDisplay.textContent='Oitava: '+octaveShift; return; }
  if(e.key==="ArrowDown"){ octaveShift--; octaveDisplay.textContent='Oitava: '+octaveShift; return; }
  const keyIndex = physicalKeys.indexOf(e.key);
  if(keyIndex>=0){
    const noteIndex = keyIndex + octaveShift*12;
    if(noteIndex>=0 && noteIndex<notes.length){
      const keyElem = document.querySelectorAll('.key')[noteIndex];
      pressKey(keyElem,notes[noteIndex].freq);
    }
  }
});

// --- Pinch Zoom ---
let lastDistance = null;
let scale = 1;
const pianoElement = document.getElementById("piano");

pianoElement.addEventListener("touchmove", (e) => {
  if(e.touches.length === 2){
    e.preventDefault();
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const distance = Math.sqrt(dx*dx + dy*dy);

    if(lastDistance){
      const diff = distance - lastDistance;
      scale += diff * 0.002;
      if(scale < 0.5) scale = 0.5;
      if(scale > 2.5) scale = 2.5;
      pianoElement.style.transform = `scale(${scale})`;
    }
    lastDistance = distance;
  }
});

pianoElement.addEventListener("touchend", (e)=>{ 
  if(e.touches.length < 2) lastDistance = null;
});
</script>
</body>
</html>
